# ü§ñ OpenRouter API Setup Guide

## Overview
This guide will help you set up OpenRouter API integration for Junokit AI chat functionality using the **DeepSeek R1 free model**.

---

## üîë Step 1: Get Your OpenRouter API Key

1. **Visit OpenRouter**: Go to [https://openrouter.ai/](https://openrouter.ai/)
2. **Sign Up/Login**: Create an account or log in
3. **Navigate to Keys**: Go to the "Keys" section in your dashboard
4. **Create API Key**: Click "Create Key" and copy your API key
5. **Save Securely**: Store your API key safely (you'll need it in the next step)

---

## üîß Step 2: Add API Key to AWS Secrets Manager

### Option A: Using the Helper Script (Recommended)
```bash
# Run the helper script with your API key
./scripts/add-openrouter-key.sh YOUR_ACTUAL_API_KEY_HERE
```

### Option B: Manual AWS CLI Command
```bash
aws secretsmanager update-secret \
    --secret-id junokit-api-secrets \
    --secret-string '{"openRouterApiKey":"YOUR_ACTUAL_API_KEY_HERE","slackBotToken":"","githubToken":"","googleClientId":"","googleClientSecret":"","autoGenerated":"PLACEHOLDER"}' \
    --region eu-north-1
```

---

## üöÄ Step 3: Deploy Updated Lambda Function

```bash
# Navigate to CDK directory
cd infrastructure/aws-cdk

# Deploy the updated Lambda function
cdk deploy
```

---

## üß™ Step 4: Test Your AI Chat

### Development Testing (Mock Responses)
```bash
# Start development server
cd frontend && npm run dev

# Visit: http://localhost:3002/chat
# Login with: demo@junokit.com / TempPass123!
```

### Production Testing (Real AI)
1. **Login**: Use demo credentials at `http://localhost:3002/login`
2. **Navigate**: Go to `/chat` page
3. **Test Chat**: Send a message to test AI responses
4. **Verify**: Check that responses come from DeepSeek R1 model

---

## ü§ñ AI Model Configuration

### Current Model: DeepSeek R1 (Free)
- **Model ID**: `deepseek/deepseek-r1-0528:free`
- **Cost**: Free tier available
- **Features**: Advanced reasoning capabilities
- **Context**: 20 previous messages for conversation context

### Available Models (You can change in Lambda function):
```typescript
// In backend/functions/chat/ai-chat.ts
model: 'deepseek/deepseek-r1-0528:free'        // Free DeepSeek R1
model: 'openai/gpt-4o-mini'                    // OpenAI GPT-4o Mini
model: 'openai/gpt-4o'                         // OpenAI GPT-4o
model: 'anthropic/claude-3-haiku'              // Claude 3 Haiku
model: 'anthropic/claude-3-sonnet'             // Claude 3 Sonnet
```

---

## üîç Troubleshooting

### Common Issues:

#### 1. "OpenRouter API key not configured"
- **Solution**: Make sure you've added your API key to AWS Secrets Manager
- **Check**: Run the helper script again with your actual API key

#### 2. "API request failed: 401"
- **Solution**: Your API key might be invalid or expired
- **Check**: Verify your API key on OpenRouter dashboard

#### 3. "API request failed: 429"
- **Solution**: You've hit rate limits
- **Check**: Wait a few minutes or upgrade your OpenRouter plan

#### 4. Lambda function timeout
- **Solution**: The current timeout is 60 seconds, which should be sufficient
- **Check**: Monitor CloudWatch logs for detailed error messages

### Debug Commands:
```bash
# Check AWS Secrets Manager
aws secretsmanager get-secret-value --secret-id junokit-api-secrets --region eu-north-1

# Check Lambda logs
aws logs tail /aws/lambda/junokit --region eu-north-1 --follow

# Test API endpoint directly
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"message":"Hello AI!"}' \
     https://nayr2j5df2.execute-api.eu-north-1.amazonaws.com/v1/chat
```

---

## üìä API Usage & Monitoring

### OpenRouter Dashboard
- **Usage Tracking**: Monitor your API usage at [OpenRouter Dashboard](https://openrouter.ai/activity)
- **Rate Limits**: Check your current rate limits and usage
- **Billing**: Monitor costs (DeepSeek R1 free tier available)

### AWS CloudWatch
- **Lambda Metrics**: Monitor function invocations, duration, and errors
- **API Gateway**: Track request counts and response times
- **DynamoDB**: Monitor read/write capacity and throttling

---

## üéØ Next Steps After Setup

1. **Test Chat Functionality**: Verify AI responses are working
2. **Monitor Usage**: Keep an eye on OpenRouter API usage
3. **Optimize Performance**: Adjust Lambda memory/timeout if needed
4. **Add More Models**: Experiment with different AI models
5. **Implement Streaming**: Add real-time streaming responses (Phase 4 Step 4)

---

## üîê Security Notes

- **API Key Security**: Never commit API keys to version control
- **AWS Secrets**: API keys are encrypted in AWS Secrets Manager
- **Access Control**: Lambda functions have minimal required permissions
- **HTTPS Only**: All API communications use HTTPS encryption

---

## üí° Tips for Best Results

1. **Clear Prompts**: Be specific in your chat messages
2. **Context Aware**: The AI remembers the last 20 messages in conversation
3. **Model Selection**: DeepSeek R1 is great for reasoning tasks
4. **Rate Limits**: Be mindful of API rate limits during testing

---

Your Junokit AI is now ready with real AI capabilities! üéâ

**Test URL**: http://localhost:3002/chat
**Login**: demo@junokit.com / TempPass123! 